<%= simple_form_for @candidate_list do |f| %>
  <%= f.error_notification %>
  <% theme_code = get_theme_code
     anonymize = false %>
  <table>
    <tr>
      <th align="right"><%= t 'bingo_games.topic' %></th>
      <td><%= @candidate_list.bingo_game.topic %></td>
    </tr>
    <tr>
      <th align="right"><%= t :description %>:</th>
      <td><%= raw( @candidate_list.bingo_game.description ) %></td>
    </tr>
    <tr>
      <th align="right"><%= t :for %>:</th>
      <td>
        <%= current_user.name( anonymize ) %>
        <% # Is group play possible?
          if @candidate_list.bingo_game.group_option? &&
              @candidate_list.bingo_game.project.group_for_user( current_user ).present? %>
        <% if @candidate_list.is_group? %>
          <em><%= t '.behalf' %>: <%= @candidate_list.group.get_name( anonymize ) %></em>
        <% else %>
          <% if @candidate_list.group_requested # Have you already requested collaboration? %>
            [<%= t '.waiting' %>]
          <% elsif @candidate_list.others_requested_help > 0 # Is your team waiting to hear from you?
              group = @candidate_list.bingo_game.project.group_for_user( current_user )
            %>
          <%= t '.req_rec', grp_name: group.get_name( anonymize ) %>: 
          <%= link_to (t :accept ), request_bingo_collaboration_path( 
                        id: @candidate_list.id, desired: "yes" ),
                        data: { confirm: (t '.confirm_accept' ) } %> or
          <%= link_to (t :decline ), request_bingo_collaboration_path( 
                        id: @candidate_list.id, desired: "no" ), 
                        data: { confirm: (t '.confirm_decline' ) } %>
        <% else 
                query = t '.req_help', grp_name:
                @candidate_list.bingo_game.project.group_for_user( current_user ).
                  get_name( anonymize ) %>
        <%= link_to( query, request_bingo_collaboration_path( 
                        id: @candidate_list.id, desired: "yes" ), 
                        data: { confirm: (t '.confirm_accept' ) } ) %>
      <% end %>
    <% end %>
  <% end %>
</tr>
<tr>
  <th align="right"><%= t 'bingo_games.date' %>:</th>
  <td><%= l @candidate_list.bingo_game.end_date, format: :tz_clarity %>
  </tr>
  <tr>
    <td colspan='2'><%= t '.instructions' %></td>
  </tr>
</table>
<h2><%= t 'candidate_lists.terms' %></h2>
<table id="candidates_table" width="100%"
        class="table-stroke-ui ui-shadow table-stripe table-ui-responsive" >
  <thead>
    <tr>
      <th width="5%" >#</th>
      <th width="5%" ><%= t '.dup' %></th>
      <th width="30%"><%= t 'candidate_lists.term' %></th>
      <th><%= t '.def' %></th>
    </tr>
  </thead>
  <tbody>
    <% count = 0 %>
    <%= f.simple_fields_for :candidates do |cf| %>
      <tr>
        <td><%= count += 1 %><%= cf.input :id, as: :hidden %><%= cf.input :user_id, as: :hidden %></td>
        <td><%= cf.object.term == '' ? '' : ( @term_counts[ cf.object.filtered_consistent ] > 1 ? '*' : '' ) %></td>
        <td><%= cf.input :term, label: false %></td>
        <td><%= cf.input :definition, as: :text, label: false %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<div class="form-actions">
  <%= f.button :submit, t(:save) %>
</div>
<% end %>
