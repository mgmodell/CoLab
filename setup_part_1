#/bin/bash

sudo apt-get install curl wget

wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -

curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list


sudo apt-get update
sudo apt-get upgrade
gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB

sudo apt-get -y install curl zsh software-properties-common mariadb-server imagemagick libmysqlclient-dev firefox google-chrome-stable x11-apps nodejs yarn
chsh -s $(which zsh)
sudo service mysql start
echo 'setting up DB users'
sudo mysql < ./initDBs.sql

sudo apt-add-repository -y ppa:rael-gc/rvm
sudo apt-get update
sudo apt-get install rvm

if ! grep -q "S3_BUCKET_NAME" ~/.profile; then
	echo "export S3_BUCKET_NAME=colab-dev" >> ~/.profile
	echo "export AWS_ACCESS_KEY_ID=XXXXXXX" >> ~/.profile
	echo "export AWS_SECRET_ACCESS_KEY=XXXXXXX" >> ~/.profile
	echo "export AWS_REGION=ap-northeast-2" >> ~/.profile
	echo "export DISPLAY=:0" >> ~/.profile
	echo "export LIBGL_ALWAYS_INDIRECT=1" >> ~/.profile
fi

echo '**********************'
echo 'First part of installation is complete'
echo 'On Ubuntu (not on Windows), please set'
echo '"Run command as a login" shell in the '
echo 'Terminal Preferences'
echo ''
echo 'Please close all your Ubuntu/Linux windows'
echo 'If you are running Ubuntu, log out and'
echo 'back in.
echo 'Then open a new Ubuntu/Linux window and:'
echo '**answer with the number 2**'
echo 'cd dev/colab'
echo '/bin/sh setup_part_2'
